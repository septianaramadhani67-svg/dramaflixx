# JSP Drama — Next.js (pages) demo

> Project template included below. Copy files into a Next.js project (Node 18+). This demo shows:
> - Dark / Light mode toggle
> - Pagination + episode list for a drama
> - HLS (.m3u8) playback via `hls.js` with mp4 fallback
> - Next.js routing (`/` index and `/drama/[id]` pages)
> - `public/videos/` usage for local files
> - Automatic playlist (play next episode when one ends)

---

## file: package.json

```json
{
  "name": "jsp-drama-demo",
  "version": "1.0.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start"
  },
  "dependencies": {
    "hls.js": "^1.5.0",
    "next": "^13.4.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0"
  },
  "devDependencies": {
    "autoprefixer": "^10.4.14",
    "postcss": "^8.4.21",
    "tailwindcss": "^3.4.0"
  }
}
```

---

## file: tailwind.config.js

```js
module.exports = {
  content: ["./pages/**/*.{js,jsx}", "./components/**/*.{js,jsx}"],
  darkMode: 'class',
  theme: {
    extend: {},
  },
  plugins: [],
};
```

---

## file: postcss.config.js

```js
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};
```

---

## file: pages/_app.js

```jsx
import '../styles/globals.css';
import { useEffect, useState } from 'react';

export default function App({ Component, pageProps }) {
  // simple theme persisting
  const [theme, setTheme] = useState('dark');
  useEffect(() => {
    const t = localStorage.getItem('theme') || 'dark';
    setTheme(t);
    document.documentElement.classList.toggle('dark', t === 'dark');
  }, []);
  const toggleTheme = () => {
    const next = theme === 'dark' ? 'light' : 'dark';
    setTheme(next);
    localStorage.setItem('theme', next);
    document.documentElement.classList.toggle('dark', next === 'dark');
  };

  return (
    <div className="min-h-screen bg-gradient-to-b from-slate-900 via-slate-800 to-slate-700 dark:from-slate-50 dark:via-slate-100 dark:to-slate-200 transition-colors">
      <div className="max-w-6xl mx-auto p-4">
        <header className="flex items-center justify-between mb-6">
          <div>
            <h1 className="text-2xl font-extrabold text-white dark:text-slate-900">JSP Drama</h1>
            <p className="text-sm text-white/60 dark:text-slate-800/60">Next.js + Tailwind demo</p>
          </div>
          <div className="flex items-center gap-3">
            <button onClick={toggleTheme} className="px-3 py-2 rounded-lg bg-white/6 dark:bg-slate-200/60 text-white dark:text-slate-900">
              {theme === 'dark' ? 'Mode Gelap' : 'Mode Terang'} — Toggle
            </button>
          </div>
        </header>

        <Component {...pageProps} />
      </div>
    </div>
  );
}
```

---

## file: pages/index.js

```jsx
import Link from 'next/link';

// Demo dataset — you can move these JSON entries to a separate file or CMS
const dramas = [
  {
    id: 'kdrama-1',
    title: 'K-Drama Example',
    year: 2024,
    poster: '/videos/poster1.jpg',
    description: 'Contoh K-Drama.',
  },
  {
    id: 'cdrama-1',
    title: 'C-Drama Example',
    year: 2023,
    poster: '/videos/poster2.jpg',
    description: 'Contoh C-Drama.',
  },
];

export default function Home() {
  return (
    <main>
      <section className="grid md:grid-cols-2 gap-6">
        {dramas.map((d) => (
          <Link key={d.id} href={`/drama/${d.id}`}>
            <a className="block bg-white/5 dark:bg-white/90 p-3 rounded-2xl hover:scale-[1.01] transition">
              <div className="flex gap-3 items-center">
                <img src={d.poster} className="w-28 h-16 object-cover rounded-lg" />
                <div>
                  <div className="font-semibold text-white dark:text-slate-900">{d.title}</div>
                  <div className="text-sm text-white/60 dark:text-slate-700/60">{d.year}</div>
                  <div className="text-xs text-white/50 dark:text-slate-700/50">{d.description}</div>
                </div>
              </div>
            </a>
          </Link>
        ))}
      </section>
    </main>
  );
}
```

---

## file: pages/drama/[id].js

```jsx
import { useRouter } from 'next/router';
import Player from '../../components/Player';
import Link from 'next/link';
import { useMemo, useState } from 'react';

// Sample episodes for demos. Replace 'src' with either .m3u8 or mp4 inside /public/videos
const dramasDB = {
  'kdrama-1': {
    id: 'kdrama-1',
    title: 'K-Drama Example',
    episodes: [
      { id: 'e1', title: 'Episode 1', src: '/videos/kdrama1-e1.m3u8', poster: '/videos/poster1.jpg' },
      { id: 'e2', title: 'Episode 2', src: '/videos/kdrama1-e2.m3u8', poster: '/videos/poster1.jpg' },
      { id: 'e3', title: 'Episode 3', src: '/videos/kdrama1-e3.m3u8', poster: '/videos/poster1.jpg' }
    ]
  },
  'cdrama-1': {
    id: 'cdrama-1',
    title: 'C-Drama Example',
    episodes: [
      { id: 'e1', title: 'Episode 1', src: '/videos/cdrama1-e1.mp4', poster: '/videos/poster2.jpg' },
      { id: 'e2', title: 'Episode 2', src: '/videos/cdrama1-e2.mp4', poster: '/videos/poster2.jpg' }
    ]
  }
};

export default function DramaPage() {
  const router = useRouter();
  const { id } = router.query;
  const drama = dramasDB[id];
  const [page, setPage] = useState(1);
  const pageSize = 4;

  const episodesPaged = useMemo(() => {
    if (!drama) return [];
    const start = (page - 1) * pageSize;
    return drama.episodes.slice(start, start + pageSize);
  }, [drama, page]);

  if (!drama) return <div>Drama tidak ditemukan — kembali ke <Link href="/">beranda</Link>.</div>;

  return (
    <div className="grid md:grid-cols-3 gap-6">
      <div className="md:col-span-2">
        <Player episodes={drama.episodes} />
      </div>

      <aside className="bg-white/5 dark:bg-white/90 p-4 rounded-2xl">
        <h2 className="font-bold mb-2 text-white dark:text-slate-900">{drama.title}</h2>
        <div className="space-y-2">
          {episodesPaged.map((ep) => (
            <div key={ep.id} className="flex items-center gap-3 p-2 rounded-lg bg-white/3 hover:bg-white/6 cursor-pointer" onClick={() => { /* handled inside player via event */ }}>
              <img src={ep.poster} className="w-20 h-12 object-cover rounded" />
              <div>
                <div className="font-medium text-white dark:text-slate-900">{ep.title}</div>
                <div className="text-xs text-white/60 dark:text-slate-700/60">{ep.id}</div>
              </div>
            </div>
          ))}
        </div>

        {/* Pagination controls */}
        <div className="flex items-center justify-between mt-4">
          <button onClick={() => setPage(p=>Math.max(1,p-1))} className="px-3 py-1 rounded bg-white/6">Prev</button>
          <div className="text-sm">Halaman {page}</div>
          <button onClick={() => setPage(p=>p+1)} className="px-3 py-1 rounded bg-white/6">Next</button>
        </div>
      </aside>
    </div>
  );
}
```

---

## file: components/Player.js

```jsx
import { useEffect, useRef, useState } from 'react';
import Hls from 'hls.js';

export default function Player({ episodes = [] }) {
  const videoRef = useRef(null);
  const [index, setIndex] = useState(0);
  const [quality, setQuality] = useState('auto');
  const [isHlsSupported, setIsHlsSupported] = useState(false);
  const [hlsInstance, setHlsInstance] = useState(null);

  useEffect(() => {
    setIsHlsSupported(Hls.isSupported());
  }, []);

  useEffect(() => {
    // load episode when index or quality changes
    loadSrc(currentEpisode()?.src);
    // cleanup on unmount
    return () => {
      if (hlsInstance) {
        hlsInstance.destroy();
        setHlsInstance(null);
      }
    };
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [index, quality]);

  function currentEpisode() {
    return episodes[index] || null;
  }

  function loadSrc(src) {
    const video = videoRef.current;
    if (!video) return;

    // destroy existing hls if any
    if (hlsInstance) {
      hlsInstance.destroy();
      setHlsInstance(null);
    }

    // if src endsWith .m3u8 and Hls supported => use hls.js
    if (src && src.endsWith('.m3u8') && Hls.isSupported()) {
      const hls = new Hls();
      hls.loadSource(src);
      hls.attachMedia(video);
      hls.on(Hls.Events.MANIFEST_PARSED, () => {
        // autoplay if user interacted (browsers restrict autoplay)
        // video.play().catch(()=>{});
      });
      setHlsInstance(hls);
    } else {
      // direct src (mp4) — just set src
      video.src = src || '';
    }
  }

  function handleEnded() {
    // autoplay next in playlist
    const next = (index + 1) % episodes.length;
    setIndex(next);
  }

  return (
    <div className="bg-white/5 dark:bg-white/90 p-3 rounded-2xl">
      <div className="relative">
        <video
          ref={videoRef}
          controls
          poster={currentEpisode()?.poster}
          onEnded={handleEnded}
          className="w-full rounded-lg bg-black"
        />

        <div className="absolute right-3 top-3 bg-black/40 rounded-xl p-2">
          <select value={quality} onChange={(e) => setQuality(e.target.value)} className="bg-transparent text-white">
            <option value="auto">Auto</option>
            <option value="1080">1080p</option>
            <option value="720">720p</option>
            <option value="480">480p</option>
          </select>
        </div>
      </div>

      <div className="mt-3 flex items-center justify-between">
        <div>
          <div className="font-bold text-lg text-white dark:text-slate-900">{currentEpisode()?.title || 'Pilih Episode'}</div>
          <div className="text-sm text-white/60 dark:text-slate-700/60">Playlist otomatis — video akan melanjutkan ke episode berikutnya.</div>
        </div>

        <div className="flex gap-2">
          <button onClick={() => setIndex(i => Math.max(0, i-1))} className="px-3 py-2 rounded bg-white/6">Prev</button>
          <button onClick={() => setIndex(i => (i+1) % episodes.length)} className="px-3 py-2 rounded bg-white/6">Next</button>
        </div>
      </div>

      {/* Episode thumbnails */}
      <div className="mt-4 grid grid-cols-3 gap-3">
        {episodes.map((ep, i) => (
          <div key={ep.id} onClick={() => setIndex(i)} className={`cursor-pointer p-2 rounded-lg ${i===index ? 'ring-2 ring-offset-2 ring-indigo-400' : 'hover:bg-white/6'}`}>
            <img src={ep.poster} className="w-full h-20 object-cover rounded" />
            <div className="text-sm mt-1 text-white dark:text-slate-900">{ep.title}</div>
          </div>
        ))}
      </div>
    </div>
  );
}
```

---

## file: styles/globals.css

```css
@tailwind base;
@tailwind components;
@tailwind utilities;

html { font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto; }

/* light-mode adjustments when `dark` class is absent */
:root { --card: rgba(255,255,255,0.06); }

/* minimal resets for images */
img { display: block; }
```

---

## file structure hints

```
/pages
  |_ _app.js
  |_ index.js
  |_ drama/[id].js
/components
  |_ Player.js
/public
  |_ videos
      |_ kdrama1-e1.m3u8
      |_ kdrama1-e2.m3u8
      |_ kdrama1-e3.m3u8
      |_ cdrama1-e1.mp4
      |_ cdrama1-e2.mp4
      |_ poster1.jpg
      |_ poster2.jpg
/tailwind.config.js
/postcss.config.js
/styles/globals.css
/package.json
```

---

## Notes & tips
- Put your local static video files and poster images into `public/videos/` so Next.js serves them statically (e.g. `public/videos/kdrama1-e1.m3u8`).
- HLS (`.m3u8`) requires CORS if hosted on another domain — local `public/` files will work without CORS issues.
- Browser HLS support: desktops generally need hls.js for .m3u8; Safari supports HLS natively. The Player checks `Hls.isSupported()` and uses hls.js when required.
- Pagination in `/drama/[id]` is simple page number based. You can enhance it to show page count or disable Next when at end.
- Theme toggle stores preference in `localStorage` and toggles `document.documentElement.classList` to activate Tailwind's `dark:` styles.
- Playlist auto-advance is implemented in `Player.js` by `onEnded` which advances `index` modulo episode length.

---

If Anda mau, saya bisa:
- Masukkan contoh file `.m3u8` stub (tiny playlist) into `public/videos/` for testing, atau
- Convert this into **app router** (Next.js 13+) structure, atau
- Tambahkan server-side API untuk memuat daftar drama dari file JSON.

Sebutkan pilihan Anda, lalu saya update dokumen lagi.
